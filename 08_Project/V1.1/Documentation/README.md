
# README TechGrounds Project 1.0

This is guide will ease your way into the delivered Infrastructure as Code (IaC). It contains the prerequisites to start with the AWS CDK and how to deploy and adjust the IaC.

# Prerequisites

- [NodeJS](https://cdkworkshop.com/15-prerequisites/300-nodejs.html)
- [Python 3](https://www.python.org/)
  - Note: Add Python 3.x to PATH checkbox on the first screen of the Python installer wizard.
- [AWS CLI](https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-getting-started.html)
- [AWS Account and User](https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-quickstart.html)
- [AWS CDK Toolkit](https://cdkworkshop.com/15-prerequisites/500-toolkit.html)
- [Create self signed certificate](https://linuxize.com/post/creating-a-self-signed-ssl-certificate/)
- [Import self signed certificate to AWS Certificate Manager](https://docs.aws.amazon.com/acm/latest/userguide/import-certificate-api-cli.html)

## Set up your CDK

Create a virtualenv:

```
python -m venv .venv
```

After the init process completes and the virtualenv is created, you can use the following
step to activate your virtualenv.

```
source .venv/bin/activate
```

If you are a Windows platform, you would activate the virtualenv like this:

```
% .venv\Scripts\activate.bat
```

Once the virtualenv is activated, you can install the required dependencies.

```
pip install -r requirements.txt
```

# Adjust the IaC before deploying

1. Edit the IP adress variable to the administrators home IP adress in the top of the `sg_construct.py` file.
2. Create a key pair. Follow these [instructions](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/create-key-pairs.html). Name the key pair 'project_key_pair' and carefully store your `project_key_pair.pem` file.
   - It's possible to adjust the name of the key pair by editing the variable on line 21 in the `project_v1_1_stack.py` file.
3. Adjust the ARN  in `elb_construct.py` to designated ARN generated by AWS Certificate Manager.
4. The Infrastructure as Code is now ready to be deployed by using the following command:

    ```
    cdk deploy
    ```

# Connecting through RDP to Admin Server

1. Go to the AWS Managements Console and go to the service 'Ec2'. Look for your running 'admin server' instance and click on 'Connect'.
2. Navigate to the tab 'RDP Client' and click on 'Download remote desktop file'.
3. To log in to the instance a password is needed. Click on 'Get password' and locate the key pair which was made before. Decrypt the password and use it to log in as Administrator on the Windows Server.

# Connecting through SSH to Web Server via Admin Server

Navigate to the directory the key pair is stored and start the SSH agent in Git Bash from there.

```
ssh-agent bash
```

Add the key pair to the agent. Edit the key pair name if it has been named differently.

```
ssh-add project_key_pair.pem
```

SSH to your Admin server's public IP. Add the -A -J to enable forwarding of the connection to the webserver TEMPLATE.

```
ssh -A -J Administrator@<admin.server.public.ip>  ec2-user@<webTEMPLATE.private.ip>
```

A password is now being asked to enter the Admin Server as user Administrator. Password can be acquired as explained in step 3 of 'Connecting through RDP to Admin Server'.


# Edit website content

When the website needs to be updated the `web_content.zip` can be overwritten in the `postdeploymentscripts` directory. Just replace this ZIP file without adjusting the name.

# Edit or add IP adress of administrator

Edit or add the IP adress of the administrator in the console at the Sceurity Groups and the NACL's.
- Go to the AWS console --> EC2 Instances --> Security Groups --> Inbound rules --> Edit inbound rules 
- Go to the AWS console --> VPC --> Network ACL's --> Inbound rules --> Edit inbound rules
- You can edit the existing rule or add an other IP adress

# Clean up
After testing destroy the stack by using:
``` 
$ cdk destroy
```
